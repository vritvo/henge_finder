<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Henge Finder</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Mobile block message -->
    <div class="mobile-block" id="mobileBlock">
        <h1>Desktop Required</h1>
        <p>Henge Finder requires a desktop or laptop computer.</p>
        <p>Please visit this site on a desktop browser to find your street's henge alignment.</p>
    </div>

    <div class="container" id="mainContainer">
        <h1>Henge Finder</h1>
        
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="showTab('finder')">Find a Henge</button>
            <button class="tab-button" onclick="showTab('learn')">How It Works</button>
        </div>

        <!-- Finder Tab Content -->
        <div class="tab-content active" id="finder-tab">
            <div class="instructions">
                <details>
                    <summary style="cursor: pointer; color: #5E4955; font-weight: 600; margin-bottom: 10px; padding: 15px; border-radius: 8px; background: #f8f9fa; border: 1px solid #e1e5e9; transition: background-color 0.2s;">
                        <span style="font-size: 1.4em;">What is a henge?</span>
                    </summary>
                    <div style="display: flex; align-items: flex-start; gap: 20px; margin-top: 15px;">
                        <div style="flex: 1;">
                            <p style="color: #2A2B2A; line-height: 1.6; margin-bottom: 15px;">A 'henge' is when the sun sets perfectly in line with your street, creating a dramatic view ‚Äî like <a href="https://en.wikipedia.org/wiki/Manhattanhenge" target="_blank" style="color: #996888; text-decoration: none;">Manhattanhenge</a> in New York.</p>
                            <p style="color: #2A2B2A; line-height: 1.6; margin-bottom: 0;">Use this tool to find when the next henge will happen for your street.</p>
                        </div>
                        <div style="flex-shrink: 0; max-width: 300px;">
                            <img src="{{ url_for('static', filename='images/city_henge.png') }}" 
                                 alt="Example of a street henge with the sun aligned down a city street" 
                                 style="width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        </div>
                    </div>
                </details>
            </div>

            <div class="instructions">
                <details>
                    <summary style="cursor: pointer; color: #5E4955; font-weight: 600; margin-bottom: 10px; padding: 15px; border-radius: 8px; background: #f8f9fa; border: 1px solid #e1e5e9; transition: background-color 0.2s;">
                        <span style="font-size: 1.4em;">What makes a good street for a henge?</span>
                    </summary>
                    <p style="color: #2A2B2A; margin-bottom: 15px;"><em>(Tips for finding the best henge view)</em></p>
                    <ul style="color: #2A2B2A; line-height: 1.6; margin-left: 20px; margin-bottom: 20px;">
                        <li><strong>Pick a long, straight road with a clear view of the horizon.</strong><br>
                        Henges work best when you can actually see the sun touch the horizon. Curvy streets won't align well, and wider streets tend to give better views.</li>
                        <li><strong>Aim for a mostly east‚Äìwest street.</strong><br>
                        The sun won't set along a north‚Äìsouth road. It doesn't have to be perfect ‚Äî the sunset shifts a little each day.</li>
                        <li><strong>Avoid entering an intersection address if possible.</strong><br>
                        It's not necessary for this to work, but it will be faster.</li>
                    </ul>
                    <p style="color: #2A2B2A; margin-bottom: 10px;"><strong>Example Streets:</strong></p>
                    <ul style="color: #2A2B2A; line-height: 1.6; margin-left: 20px;">
                        <li><a href="https://www.google.com/maps/place/251+W+42nd+St,+New+York,+NY+10036/@40.7570115,-73.9893081,18z/data=!4m15!1m8!3m7!1s0x89c2585360bfe5e7:0xd3b373353146c43f!2s251+W+42nd+St,+New+York,+NY+10036!3b1!8m2!3d40.757119!4d-73.9891884!16s%2Fg%2F11nnknww84!3m5!1s0x89c2585360bfe5e7:0xd3b373353146c43f!8m2!3d40.757119!4d-73.9891884!16s%2Fg%2F11nnknww84?entry=ttu&g_ep=EgoyMDI1MDczMC4wIKXMDSoASAFQAw%3D%3D" target="_blank" style="color: #996888; text-decoration: none;">251 W 42nd St, New York, NY</a>, by Times Square</li>
                        <li><a href="https://www.google.com/maps/place/601+E+76th+St,+Chicago,+IL+60619/@41.756679,-87.61279,17z/data=!3m1!4b1!4m5!3m4!1s0x880e28c816730d29:0x111671091e24efc4!8m2!3d41.756675!4d-87.6102151?entry=ttu&g_ep=EgoyMDI1MDczMC4wIKXMDSoASAFQAw%3D%3D" target="_blank" style="color: #996888; text-decoration: none;">601-615 E 76th St, Chicago, IL</a></li>
                        <li><a href="https://www.google.com/maps/place/Haarlemmerweg+109-C,+1051+KV+Amsterdam,+Netherlands/@52.3853326,4.8733117,19z/data=!3m1!4b1!4m6!3m5!1s0x47c609d5b0e41589:0xf6191c1b666122c1!8m2!3d52.3853318!4d4.8739554!16s%2Fg%2F11nnkplcpz?entry=ttu&g_ep=EgoyMDI1MDgyNC4wIKXMDSoASAFQAw%3D%3D" target="_blank" style="color: #996888; text-decoration: none;">Haarlemmerweg 109-C, 1051 KV Amsterdam, Netherlands</a>, along the canal by the Wester Park</li>
                    </ul>
                </details>
            </div>
            <form id="hengeForm">
                <h3 style="color: #DC816E; margin-bottom: 15px; font-size: 1.3em;">Step 1: Enter an address</h3>
                <div class="form-group">
                    <input type="text" id="address" name="address" placeholder="e.g., 251 W 42nd St, New York, NY 10036" required>
                </div>
                <button type="submit" id="submitBtn">Find Address</button>
            </form>

            <div class="loading" id="loading" style="display: none;">
                <div class="spinner"></div>
                <p>May take a second...</p>
            </div>

            <div class="result" id="addressResult"></div>
            
            <div class="map-container" id="mapContainer" style="display: none;">
                <h3 style="color: #DC816E; margin-bottom: 15px; font-size: 1.3em;">Step 2: Adjust the arrow to match the street's direction</h3>
                <div class="step-instructions">
                    <p>We've estimated your street's direction from map data. <strong>If the arrow aligns with your street, you're all set!</strong> If not, drag the arrow handle to match the street direction you want the henge for.</p>
                </div>
                <div class="compass-container">
                    <div class="compass-marker compass-north">N</div>
                    <div class="compass-marker compass-south">S</div>
                    <div class="compass-marker compass-east">E</div>
                    <div class="compass-marker compass-west">W</div>
                    <div id="map"></div>
                </div>
                <div class="bearing-controls">
                    <div class="bearing-info">
                        <span>Road <span class="tooltip-term">Bearing<span class="tooltip">Angle of a terrestrial object (e.g. a road) measured clockwise from True North</span></span>:</span>
                        <span class="bearing-value" id="bearingValue">0¬∞</span>
                    </div>
                    <div class="bearing-buttons">
                        <button class="bearing-btn reset-btn" id="resetBtn">Reset to Original</button>
                    </div>
                </div>
                <div class="map-info">
                    <strong>Map Legend:</strong> Dark arrow shows the road <span class="tooltip-term">bearing<span class="tooltip">Angle of a terrestrial object (e.g. a road) measured clockwise from True North</span></span> direction (drag to adjust).
                </div>
                <div class="main-action">
                    <h3 style="color: #DC816E; margin-bottom: 15px; font-size: 1.3em; text-align: left;">Step 3: Find henge</h3>
                    <button class="main-btn" id="calculateHengeBtn">Let's go!</button>
                </div>
            </div>

            <div class="result" id="hengeResult" style="display: none;"></div>
        </div>

        <!-- Learn Tab Content -->
        <div class="tab-content" id="learn-tab">
            <!-- Street Henge Visualization -->
            <div class="education-section">
                <h2>üèôÔ∏è See How the Sun Moves Down Your Street</h2>
                <p>Compare two different dates to see why henges only happen at specific times of year:</p>
                
                <div style="display: flex; gap: 20px; margin: 30px 0;">
                    <!-- Non-Henge Date View (Left) -->
                    <div style="flex: 1;">
                        <h3 style="text-align: center; color: #5E4955; margin-bottom: 15px;">Non-Henge Date</h3>
                        <div class="street-henge-container">
                            <canvas id="streetNonHengeCanvas" class="street-henge-canvas"></canvas>
                            <div class="street-time-controls">
                                <div class="street-time-display" id="streetNonHengeTimeDisplay">7:00 PM</div>
                                <div class="street-time-slider-container">
                                    <input type="range" id="streetNonHengeTimeSlider" class="street-time-slider" min="90" max="180" value="180" step="1">
                                </div>
                                <div class="street-time-labels">
                                    <span>5:30 PM</span>
                                    <span>7:00 PM</span>
                                </div>
                                <div class="henge-indicator" id="nonHengeIndicator">Sun misses the street</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Henge Date View (Right) -->
                    <div style="flex: 1;">
                        <h3 style="text-align: center; color: #5E4955; margin-bottom: 15px;">Henge Date</h3>
                        <div class="street-henge-container">
                            <canvas id="streetHengeCanvas" class="street-henge-canvas"></canvas>
                            <div class="street-time-controls">
                                <div class="street-time-display" id="streetTimeDisplay">8:15 PM</div>
                                <div class="street-time-slider-container">
                                    <input type="range" id="streetTimeSlider" class="street-time-slider" min="165" max="255" value="255" step="1">
                                </div>
                                <div class="street-time-labels">
                                    <span>6:45 PM</span>
                                    <span>8:15 PM</span>
                                </div>
                                <div class="henge-indicator" id="hengeIndicator">üåÖ Perfect Henge Alignment!</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <p style="margin-top: 20px;"><em>Both views show a typical Manhattan street (299¬∞ bearing). The left view shows a non-henge date where the sun sets at the wrong angle, while the right view shows a henge date where the sun aligns perfectly with the street!</em></p>
            </div>

            <!-- Orbital Mechanics Visualization -->
            <div class="education-section">
                <h2>üåç Earth's Orbital Motion and Axial Tilt</h2>
                <p>Understanding why henges happen requires looking at Earth's motion around the Sun. These visualizations show how Earth's tilt and orbital position change throughout the year:</p>
                
               <div style="display: flex; gap: 20px; margin: 30px 0;"> 
                    <!-- Orbital View Canvas -->
                    <div style="flex: 1;">
                        <h3 style="text-align: center; color: #5E4955; margin-bottom: 15px;">Earth's Orbit (Top View)</h3>
                        <div style="background: #1a1a2e; border-radius: 10px; padding: 20px;">
                            <canvas id="orbitalCanvas" style="width: 100%; height: 300px; border-radius: 8px; display: block; background: radial-gradient(circle at center, #16213e 0%, #0f0f23 100%);"></canvas>
                        </div>
                    </div>
                    
                    <!-- Tilt View Canvas -->
                    <div style="flex: 1;">
                        <h3 style="text-align: center; color: #5E4955; margin-bottom: 15px;">Earth's Tilt (Side View)</h3>
                        <div style="background: #1a1a2e; border-radius: 10px; padding: 20px;">
                            <canvas id="tiltCanvas" style="width: 100%; height: 300px; border-radius: 8px; display: block; background: radial-gradient(circle at center, #16213e 0%, #0f0f23 100%);"></canvas>
                        </div>
                        <!-- Henge Message Display -->
                        <div id="hengeMessage" style="margin-top: 15px; padding: 10px; background: rgba(255, 179, 71, 0.1); border-radius: 8px; border-left: 4px solid #FFB347; opacity: 0; transition: opacity 0.3s; text-align: center;">
                            <div style="color: #FFB347; font-weight: bold; font-size: 14px;">üåÖ Sun azimuth at sunset matches road running down equator!</div>
                            <div style="color: #FFB347; font-weight: bold; font-size: 16px; margin-top: 5px;">Henge date!</div>
                        </div>
                    </div>
               </div> 
                
                <!-- Shared Controls -->
                <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px; margin-top: 20px;">
                    <div style="color: black; font-size: 18px; font-weight: 600; margin-bottom: 10px; text-align: center;" id="orbitalTimeDisplay">Day 1</div>
                    <div style="margin: 15px 0;">
                        <input type="range" id="orbitalTimeSlider" style="width: 100%; height: 8px; border-radius: 4px; background: #ddd; outline: none; -webkit-appearance: none;" min="0" max="365" value="0" step="1">
                    </div>
                    <div style="display: flex; justify-content: space-between; color: black; font-size: 14px; margin-top: 5px;">
                        <span>Day 1</span>
                        <span>Day Slider</span>
                        <span>Day 365</span>
                    </div>
                    <div style="color: #ffd700; font-weight: bold; margin-top: 10px; opacity: 0; transition: opacity 0.3s; text-align: center;" id="orbitalEquinoxIndicator">üåÖ Equinox - Sun sets due west!</div>
                </div>
                
                <p style="margin-top: 20px;"><em>The orbital view shows Earth's position around the Sun throughout the year. The tilt view shows how the North Pole's orientation relative to the Sun changes, affecting where the Sun appears to set.</em></p>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
</body>
</html> 